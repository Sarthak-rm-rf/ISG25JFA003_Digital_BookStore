<app-navbar></app-navbar>

<div class="min-h-screen bg-white py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center mb-8">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Orders Management</h1>
        <p class="text-gray-600">View and manage customer orders</p>
      </div>
      <button 
        (click)="loadOrders()"
        [disabled]="loading"
        class="bg-[#ff5722] text-white px-6 py-3 rounded-lg disabled:opacity-50 flex items-center">
        <span class="material-icons mr-2">refresh</span>
        Refresh Orders
      </button>
    </div>

    <!-- Error Message -->
    @if (errorMessage) {
      <div class="mb-6 p-4 bg-red-50 border-l-4 border-red-400 rounded-lg flex justify-between items-center">
        <div class="flex items-center">
          <span class="material-icons text-red-400 mr-3">error</span>
          <p class="text-red-800">{{ errorMessage }}</p>
        </div>
        <button 
          (click)="dismissError()"
          class="text-red-600">
          <span class="material-icons">close</span>
        </button>
      </div>
    }


    <!-- Loading State -->
    @if (loading && orders.length === 0) {
      <div class="text-center py-8">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[#ff5722]"></div>
        <p class="mt-2 text-gray-600">Loading orders...</p>
      </div>
    } @else {
      <div class="bg-white border border-gray-200 rounded overflow-hidden">
        @if (orders.length === 0) {
          <div class="p-8 text-center">
            <span class="material-icons text-4xl text-gray-300 mb-2">receipt_long</span>
            <h3 class="text-lg font-medium text-gray-900 mb-1">No orders found</h3>
            <p class="text-gray-500">There are no orders to display.</p>
          </div>
        } @else {
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                    Order ID
                  </th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                    Payment ID
                  </th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                    Amount
                  </th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                    Status
                  </th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                    Date
                  </th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                @for (order of orders; track order.orderId) {
                  <tr>
                    <!-- Order ID -->
                    <td class="px-4 py-3 text-sm font-medium text-gray-900">
                      #{{ order.orderId }}
                    </td>

                    <!-- Payment ID -->
                    <td class="px-4 py-3 text-sm text-gray-900">
                      {{ order.paymentId || 'N/A' }}
                    </td>

                    <!-- Amount -->
                    <td class="px-4 py-3 text-sm font-medium text-[#ff5722]">
                      ${{ order.totalAmount | number:'1.2-2' }}
                    </td>

                    <!-- Status -->
                    <td class="px-4 py-3">
                      <span [class]="'px-2 py-1 text-xs rounded ' + getStatusClass(order.orderStatus)">
                        {{ order.orderStatus || 'UNKNOWN' }}
                      </span>
                    </td>

                    <!-- Date -->
                    <td class="px-4 py-3 text-sm text-gray-500">
                      {{ order.orderDate | date:'short' }}
                    </td>

                    <!-- Actions -->
                    <td class="px-4 py-3 text-sm">
                      <button 
                        (click)="viewOrderDetails(order)"
                        class="text-[#ff5722]">
                        View
                      </button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }
      </div>

      <!-- Loading overlay for refresh operations -->
      @if (loading && orders.length > 0) {
        <div class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
          <div class="bg-white rounded p-4">
            <div class="flex items-center">
              <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-[#ff5722] mr-2"></div>
              <span class="text-gray-700 text-sm">Loading...</span>
            </div>
          </div>
        </div>
      }
    }
  </div>

  <!-- Order Details Modal -->
  @if (showOrderDetails && selectedOrder) {
    <div class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 p-4">
      <div class="bg-white rounded w-full max-w-lg">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold text-gray-900">Order #{{ selectedOrder.orderId }}</h2>
            <button 
              (click)="closeOrderDetails()"
              class="text-gray-400">
              <span class="material-icons">close</span>
            </button>
          </div>
          
          <div class="space-y-3 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">Payment ID:</span>
              <span class="text-gray-900">{{ selectedOrder.paymentId || 'N/A' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Status:</span>
              <span [class]="'px-2 py-1 text-xs rounded ' + getStatusClass(selectedOrder.orderStatus)">
                {{ selectedOrder.orderStatus }}
              </span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Date:</span>
              <span class="text-gray-900">{{ selectedOrder.orderDate | date:'medium' }}</span>
            </div>
            <div class="flex justify-between border-t pt-3">
              <span class="text-gray-600 font-medium">Total Amount:</span>
              <span class="text-[#ff5722] font-bold">${{ selectedOrder.totalAmount | number:'1.2-2' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>
